<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
  <title>arc-onboarding test</title>
  <script src="../../webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../../web-component-tester/browser.js"></script>
  <link rel="import" href="../arc-onboarding.html">
</head>
<body>
  <test-fixture id="Basic">
    <template>
      <arc-onboarding></arc-onboarding>
    </template>
  </test-fixture>

  <test-fixture id="Delay">
    <template>
      <arc-onboarding delay="5"></arc-onboarding>
    </template>
  </test-fixture>

  <script>
  suite('Initialization', () => {
    setup(() => {
      localStorage.removeItem('tutorial_onboarding13');
    });

    test('Opens the app after the timeout', (done) => {
      const element = fixture('Delay');
      setTimeout(() => {
        assert.isTrue(element.opened);
        done();
      }, 10);
    });
  });

  suite('_followLink()', () => {
    test('Does nothing when no data-href', () => {
      const element = fixture('Basic');
      const node = document.createElement('div');
      const spy = sinon.spy(window, 'open');
      element._followLink({
        target: node
      });
      window.open.restore();
      assert.isFalse(spy.called);
    });

    test('Calls window.open', () => {
      const element = fixture('Basic');
      const original = window.open;
      let calledUrl;
      window.open = (url) => {
        calledUrl = url;
      };
      const node = document.createElement('div');
      node.dataset.href = 'test';
      element._followLink({
        target: node
      });
      window.open = original;
      assert.equal(calledUrl, 'test');
    });
  });
  </script>
</body>
</html>
